# ğŸ® Iyagi AI VN Generator - ê²Œì„ ìƒì„± í”Œë¡œìš°

> AIê°€ ìë™ìœ¼ë¡œ ë¹„ì£¼ì–¼ë…¸ë²¨ì„ ìƒì„±í•˜ëŠ” ì „ì²´ ê³¼ì •

---

## ğŸ“‹ ëª©ì°¨

1. [ì „ì²´ í”Œë¡œìš° ê°œìš”](#ì „ì²´-í”Œë¡œìš°-ê°œìš”)
2. [Phase 1: í”„ë¡œì íŠ¸ ì„¤ì • (Setup Wizard)](#phase-1-í”„ë¡œì íŠ¸-ì„¤ì •-setup-wizard)
3. [Phase 2: ì—ì…‹ ìƒì„± (Asset Generation)](#phase-2-ì—ì…‹-ìƒì„±-asset-generation)
4. [Phase 3: ëŸ°íƒ€ì„ ì±•í„° ìƒì„±](#phase-3-ëŸ°íƒ€ì„-ì±•í„°-ìƒì„±)
5. [ë°ì´í„° ì €ì¥ êµ¬ì¡°](#ë°ì´í„°-ì €ì¥-êµ¬ì¡°)
6. [íŠ¸ëŸ¬ë¸”ìŠˆíŒ…](#íŠ¸ëŸ¬ë¸”ìŠˆíŒ…)

---

## ğŸ¯ ì „ì²´ í”Œë¡œìš° ê°œìš”

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    1. TitleScene (ì‹œì‘)                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚  New Game    â”‚  â”‚  Load Game   â”‚  â”‚  Settings    â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              2. SetupWizardScene (í”„ë¡œì íŠ¸ ìƒì„±)                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚Step 1â”‚â†’â”‚Step 2â”‚â†’â”‚Step 3â”‚â†’â”‚Step 4â”‚â†’â”‚Step 5â”‚â†’â”‚Step 6â”‚  â”‚
â”‚  â”‚ê²Œì„  â”‚  â”‚ê°€ì¹˜  â”‚  â”‚êµ¬ì¡°  â”‚  â”‚í”Œë ˆì´ì–´â”‚ â”‚NPC   â”‚  â”‚ì™„ë£Œ  â”‚  â”‚
â”‚  â”‚ê°œìš”  â”‚  â”‚ì„¤ì •  â”‚  â”‚ì„¤ì •  â”‚  â”‚ìºë¦­í„°â”‚  â”‚ìºë¦­í„°â”‚  â”‚í™•ì¸  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            3. ì—ì…‹ ìƒì„± (ParallelAssetGenerator)                 â”‚
â”‚                                                                  â”‚
â”‚  Cycle 1 (ë³‘ë ¬)              Cycle 2 (ë³‘ë ¬)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ ìºë¦­í„° ìŠ¤íƒ ë”©    â”‚         â”‚ ì±•í„°1 JSON ìƒì„±  â”‚              â”‚
â”‚  â”‚ - Player: 5ê°œ   â”‚         â”‚ - Gemini API     â”‚              â”‚
â”‚  â”‚ - NPCë“¤: ê° 5ê°œ â”‚         â”‚ - ëŒ€ì‚¬/ì„ íƒì§€    â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚          â†“                           â†“                          â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€ BARRIER (50%) â”€â”€â”€â”˜                          â”‚
â”‚                      â†“                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ Cycle 3: ì±•í„°1 ì—ì…‹ ë³‘ë ¬ ìƒì„±                     â”‚          â”‚
â”‚  â”‚ - ë°°ê²½ ì´ë¯¸ì§€ (NanoBanana API)                   â”‚          â”‚
â”‚  â”‚ - CG ì¼ëŸ¬ìŠ¤íŠ¸ (NanoBanana API)                   â”‚          â”‚
â”‚  â”‚ - BGM (ElevenLabs API)                           â”‚          â”‚
â”‚  â”‚ - SFX (ElevenLabs API)                           â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                      â†“                                           â”‚
â”‚             FINAL BARRIER (100%)                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    4. GameScene (ê²Œì„ í”Œë ˆì´)                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚ Chapter 1 â†’ Chapter 2 â†’ ... â†’ Chapter N â†’ Ending â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚  - ìºì‹œëœ ì±•í„° ë¡œë“œ ë˜ëŠ” ìƒˆë¡œ ìƒì„±                             â”‚
â”‚  - ì„ íƒì§€ì— ë”°ë¼ ìŠ¤í‚¬/í˜¸ê°ë„ ë³€í™”                              â”‚
â”‚  - ì±•í„° ì™„ë£Œ ì‹œ AI ìš”ì•½ ìƒì„± â†’ ë‹¤ìŒ ì±•í„° ë§¥ë½ ì œê³µ             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ Phase 1: í”„ë¡œì íŠ¸ ì„¤ì • (Setup Wizard)

### Step 1: ê²Œì„ ê°œìš” (Game Overview)

**ìœ„ì¹˜**: `SetupWizardScene` â†’ `Step1_GameOverview`

**ì‚¬ìš©ì ì…ë ¥**:
- ê²Œì„ ì œëª© (Game Title)
- íƒœê·¸ë¼ì¸ (Tagline)
- ì§§ì€ ì¤„ê±°ë¦¬ (Short Synopsis)
- ìƒì„¸ ì¤„ê±°ë¦¬ (Detailed Synopsis)
- ì¥ë¥´ (Genre): School / Fantasy / SF / Mystery / Romance / Horror
- í†¤ (Tone): Bright / Calm / Dark / Comic
- ë°°ê²½ ì„¤ì • (Setting): Modern / Near Future / Medieval / 19th Century / Fantasy
- í‚¤ì›Œë“œ (Keywords)
- ì œì•½ì‚¬í•­ (Constraints): í•´í”¼ì—”ë”© ë³´ì¥, í­ë ¥ ê¸ˆì§€, ë¡œë§¨ìŠ¤ ê¸ˆì§€ ë“±

**AI ìë™ ì™„ì„± (F5 í‚¤ ë˜ëŠ” AutoFill ë²„íŠ¼)**:
```csharp
// Gemini API í˜¸ì¶œ
Prompt: "Based on the user's title and synopsis, suggest tagline, short synopsis, detailed synopsis, genre, and tone."
â†’ Response: JSON { tagline, shortSynopsis, detailedSynopsis, genre, tone }
```

**ì¶œë ¥**:
- `VNProjectData.gameTitle`
- `VNProjectData.gamePremise`
- `VNProjectData.genre`
- `VNProjectData.tone`
- `VNProjectData.keywords`

---

### Step 2: ê°€ì¹˜ ì„¤ì • (Core Values)

**ìœ„ì¹˜**: `SetupWizardScene` â†’ `Step2_CoreValues`

**ì‚¬ìš©ì ì…ë ¥**:
- í•µì‹¬ ê°€ì¹˜ (Core Values): 2-4ê°œ (ì˜ˆ: "ì •ì˜", "ì¶œì„¸", "ìš°ì •")
- ê° ê°€ì¹˜ì˜ íŒŒìƒ ìŠ¤í‚¬ (Derived Skills): 3-5ê°œ (ì˜ˆ: ì •ì˜ â†’ ìê¸ì‹¬, ê³µê°ëŠ¥ë ¥, íŒë‹¨ë ¥)
- íŠ¸ë£¨ ì—”ë”© ê°€ì¹˜ ì„ íƒ

**AI ìë™ ì œì•ˆ (AutoSuggest ë²„íŠ¼)**:
```csharp
// Gemini API í˜¸ì¶œ
Prompt: "Based on the game context, suggest 2-4 core values and their derived skills."
â†’ Response: JSON {
    coreValues: [
        { name: "ì •ì˜", derivedSkills: ["ìê¸ì‹¬", "ê³µê°ëŠ¥ë ¥", "íŒë‹¨ë ¥"] },
        { name: "ì¶œì„¸", derivedSkills: ["ì•¼ë§", "ì‚¬êµì„±"] }
    ]
}
```

**ì¶œë ¥**:
- `VNProjectData.coreValues[]`
  - `CoreValue.name`
  - `CoreValue.derivedSkills[]`
- `VNProjectData.trueValueName`

---

### Step 3: ìŠ¤í† ë¦¬ êµ¬ì¡° (Story Structure)

**ìœ„ì¹˜**: `SetupWizardScene` â†’ `Step3_StoryStructure`

**ì‚¬ìš©ì ì…ë ¥**:
- ì´ ì±•í„° ìˆ˜ (Total Chapters): 3-10ê°œ
- ë¶„ê¸° íƒ€ì… (Branching Type):
  - Linear: ì„ í˜• ìŠ¤í† ë¦¬
  - Route Split: ì¤‘ë°˜ ì´í›„ ë£¨íŠ¸ ë¶„ê¸°
  - Fully Branched: ì™„ì „ ë¶„ê¸°
- ì±•í„°ë‹¹ ì„ íƒì§€ ìˆ˜ (Choices Per Chapter): 1-4ê°œ
- ë°°ë“œì—”ë”© ë¹ˆë„ (Bad Ending Frequency): Rare / Sometimes / Frequent
- ì˜ˆìƒ í”Œë ˆì´íƒ€ì„ (Playtime): 30ë¶„ / 1ì‹œê°„ / 2ì‹œê°„ / 3ì‹œê°„+

**AI ìë™ ì œì•ˆ (AutoSuggest ë²„íŠ¼)**:
```csharp
// Gemini API í˜¸ì¶œ
Prompt: "Based on the game context, suggest optimal story structure."
â†’ Response: JSON {
    totalChapters: 5,
    branchingType: "RouteSplit",
    choicesPerChapter: 2,
    badEndingFreq: "Sometimes",
    playtime: "Hour1"
}
```

**ì¶œë ¥**:
- `VNProjectData.totalChapters`
- `VNProjectData.branchingType`
- `VNProjectData.choicesPerChapter`

---

### Step 4: í”Œë ˆì´ì–´ ìºë¦­í„° (Player Character)

**ìœ„ì¹˜**: `SetupWizardScene` â†’ `Step4_PlayerCharacter`

**ì‚¬ìš©ì ì…ë ¥**:
- ìºë¦­í„° ì´ë¦„ (Name)
- ë‚˜ì´ (Age)
- ì„±ë³„ (Gender): Male / Female / Non-Binary
- ì™¸ëª¨ ì„¤ëª… (Appearance Description)
- ì„±ê²© (Personality)
- ì›í˜• (Archetype): Hero / Strategist / Innocent / Rebel / Mentor / Trickster
- POV (Point of View): First Person / Second Person / Third Person

**ì–¼êµ´ í”„ë¦¬ë·° ìƒì„± í”Œë¡œìš°**:
```
1. ì‚¬ìš©ìê°€ "Generate Preview" ë²„íŠ¼ í´ë¦­
   â†“
2. NanoBanana API í˜¸ì¶œ (ì–¼êµ´ë§Œ, seed ì—†ìŒ)
   Prompt: "A close-up anime-style portrait, shoulders-up, front-facing,
            plain background, clean lineart, flat colors...
            Character: {appearanceDescription}"
   â†“
3. ì´ë¯¸ì§€ ìƒì„± (512x512) + seed ë°˜í™˜
   â†“
4. í”„ë¦¬ë·° íˆìŠ¤í† ë¦¬ì— ì €ì¥
   - previewHistory[] (ìµœëŒ€ 5ê°œ)
   - seedHistory[] (seed ê°’ ì €ì¥)
   â†“
5. ì‚¬ìš©ìê°€ â—€/â–¶ ë²„íŠ¼ìœ¼ë¡œ ì„ íƒ
   â†“
6. "Confirm" ë²„íŠ¼ í´ë¦­ ì‹œ:
   - CharacterData.confirmedSeed ì €ì¥
   - CharacterData.facePreview ì €ì¥
   - Resources/Generated/Characters/{CharName}/face_preview.png ì €ì¥
```

**ìŠ¤íƒ ë”© ìŠ¤í”„ë¼ì´íŠ¸ ìƒì„±ì€ Step 6ì—ì„œ ë³‘ë ¬ ì²˜ë¦¬ë¨**

**ì¶œë ¥**:
- `CharacterData` (ScriptableObject)
  - `characterName`
  - `age`, `gender`, `archetype`, `pov`
  - `appearanceDescription`, `personality`
  - `confirmedSeed` (ì¤‘ìš”! ìŠ¤íƒ ë”© ìƒì„± ì‹œ ì¬ì‚¬ìš©)
  - `facePreview` (CG ë ˆí¼ëŸ°ìŠ¤ë¡œ ì‚¬ìš©)
  - `resourcePath`: "Generated/Characters/{CharName}"

---

### Step 5: NPC ìºë¦­í„° (NPCs)

**ìœ„ì¹˜**: `SetupWizardScene` â†’ `Step5_NPCs`

**ë°˜ë³µ**: Step 4ì™€ ë™ì¼í•œ í”„ë¡œì„¸ìŠ¤ë¥¼ NPCë§ˆë‹¤ ë°˜ë³µ

**ì¶”ê°€ ì…ë ¥**:
- ì—­í•  (Role): "ì¹œêµ¬", "ë©˜í† ", "ë¼ì´ë²Œ", "ì—°ì¸" ë“±
- ë¡œë§¨ìŠ¤ ê°€ëŠ¥ ì—¬ë¶€ (Is Romanceable)
- ì´ˆê¸° í˜¸ê°ë„ (Initial Affection): -100 ~ +100

**ì–¼êµ´ í”„ë¦¬ë·° ìƒì„±**:
- **ì²« ë²ˆì§¸ NPC**: `isFirst = true` (ìŠ¤íƒ€ì¼ ê¸°ì¤€ ì„¤ì •)
- **ì¶”ê°€ NPC**: `isFirst = false` (ê¸°ì¡´ ìŠ¤íƒ€ì¼ í†µì¼)

**ì¶œë ¥**:
- `VNProjectData.npcs[]` (CharacterData ë¦¬ìŠ¤íŠ¸)

---

### Step 6: ì™„ë£Œ ë° í™•ì¸ (Finalize)

**ìœ„ì¹˜**: `SetupWizardScene` â†’ `Step6_Finalize`

**í‘œì‹œ ë‚´ìš©**:
- ê²Œì„ ì œëª©
- ì´ ì±•í„° ìˆ˜
- ìºë¦­í„° ìˆ˜ (Player + NPCs)
- í•µì‹¬ ê°€ì¹˜ ëª©ë¡
- ì˜ˆìƒ í”Œë ˆì´íƒ€ì„

**"Create Project" ë²„íŠ¼ í´ë¦­ ì‹œ**:
1. `VNProjectData.asset` ì €ì¥ (`Assets/Resources/VNProjects/{GameTitle}.asset`)
2. ê° `CharacterData.asset` ì €ì¥ (`Assets/Resources/VNProjects/{GameTitle}/Characters/`)
3. SaveFile ìƒì„± (ì´ˆê¸° GameState)
4. **ParallelAssetGenerator ì‹œì‘** â†’ Phase 2ë¡œ ì´ë™

---

## ğŸ¨ Phase 2: ì—ì…‹ ìƒì„± (Asset Generation)

### ì „ì²´ êµ¬ì¡°: Fan-Out Barrier íŒ¨í„´

**íŒŒì¼**: `ParallelAssetGenerator.cs`

```
SetupWizardManager.OnWizardComplete()
    â†“
StartCoroutine(RunParallelAssetGeneration())
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Cycle 1 & 2 ë³‘ë ¬ ì‹¤í–‰ (0% â†’ 50%)       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Cycle 1: ëª¨ë“  ìºë¦­í„° ìŠ¤íƒ ë”© ìƒì„±        â”‚
â”‚  Cycle 2: ì±•í„°1 JSON ìƒì„±               â”‚
â”‚          â†“                              â”‚
â”‚     BARRIER (50%)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Cycle 3: ì±•í„°1 ì—ì…‹ ë³‘ë ¬ ìƒì„± (50%â†’100%)â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  - ë°°ê²½ ì´ë¯¸ì§€ (2-3ê°œ)                  â”‚
â”‚  - CG ì¼ëŸ¬ìŠ¤íŠ¸ (1-2ê°œ)                  â”‚
â”‚  - BGM (3-5ê°œ)                          â”‚
â”‚  - SFX (5-10ê°œ)                         â”‚
â”‚          â†“                              â”‚
â”‚  FINAL BARRIER (100%)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
SceneManager.LoadScene("GameScene")
```

---

### Cycle 1: ìºë¦­í„° ìŠ¤íƒ ë”© ìƒì„±

**ë©”ì„œë“œ**: `ParallelAssetGenerator.GenerateAllStandingSprites()`

**ëŒ€ìƒ**:
- Player Character (1ëª…)
- NPCs (Nëª…)

**ê° ìºë¦­í„°ë‹¹ 5ì¢… ê¸°ë³¸ ìŠ¤íƒ ë”© ìƒì„±**:

| Expression | Pose   | íŒŒì¼ëª…                | API í˜¸ì¶œ |
|------------|--------|-----------------------|----------|
| Neutral    | Normal | `neutral_normal.png`  | âœ…       |
| Happy      | Normal | `happy_normal.png`    | âœ…       |
| Sad        | Normal | `sad_normal.png`      | âœ…       |
| Angry      | Normal | `angry_normal.png`    | âœ…       |
| Surprised  | Normal | `surprised_normal.png`| âœ…       |

**NanoBanana API í˜¸ì¶œ**:
```csharp
// ì²« ë²ˆì§¸ ìºë¦­í„° (Player)
Prompt: "A full-body standing sprite of a {gender} character for a Japanese-style visual novel.
         High-quality anime illustration style with clean outlines and soft gradient shading.
         Pose: front-facing, full body centered, neutral stance.
         Expression: {expression}.
         Outfit: {appearanceDescription}.
         Background: transparent or solid white.
         Resolution: 2048Ã—4096."
Seed: {confirmedSeed}  // Step 4ì—ì„œ ì €ì¥í•œ seed ì¬ì‚¬ìš©
```

```csharp
// ì¶”ê°€ ìºë¦­í„° (NPCs)
Prompt: "A full-body standing sprite of a {gender} character for a Japanese-style visual novel.
         Same art style, same proportions, and same camera angle as the previous character.
         Pose: front-facing, full body centered, neutral stance.
         Expression: {expression}.
         Outfit: {appearanceDescription}.
         Background: transparent or solid white.
         Resolution: 2048Ã—4096."
Seed: {confirmedSeed}  // ê° NPCì˜ ê³ ìœ  seed
```

**ì €ì¥ ìœ„ì¹˜**:
```
Assets/Resources/Generated/Characters/
â”œâ”€â”€ PlayerName/
â”‚   â”œâ”€â”€ face_preview.png       (Step 4ì—ì„œ ìƒì„±)
â”‚   â”œâ”€â”€ neutral_normal.png     (Cycle 1ì—ì„œ ìƒì„±)
â”‚   â”œâ”€â”€ happy_normal.png
â”‚   â”œâ”€â”€ sad_normal.png
â”‚   â”œâ”€â”€ angry_normal.png
â”‚   â””â”€â”€ surprised_normal.png
â”œâ”€â”€ NPC1_Name/
â”‚   â”œâ”€â”€ face_preview.png
â”‚   â”œâ”€â”€ neutral_normal.png
â”‚   â””â”€â”€ ...
â””â”€â”€ NPC2_Name/
    â””â”€â”€ ...
```

**ì˜ˆìƒ ì‹œê°„**: ìºë¦­í„°ë‹¹ 5ê°œ Ã— 10ì´ˆ = ì•½ 50ì´ˆ (Player + NPC 2ëª… = 150ì´ˆ)

---

### Cycle 2: ì±•í„°1 JSON ìƒì„±

**ë©”ì„œë“œ**: `ParallelAssetGenerator.GenerateChapter1JSON()`

**Gemini API í˜¸ì¶œ**:
```csharp
Prompt: ChapterGenerationManager.BuildScenePrompt(chapterId: 1, sceneNumber: 1, totalScenes: 3)

// ì£¼ìš” ì§€ì‹œì‚¬í•­:
- Game Title: {projectData.gameTitle}
- Premise: {projectData.gamePremise}
- Characters: Player, NPC1, NPC2...
- Core Values and Derived Skills: {coreValuesInfo}
- Current State: Initial chapter (no previous choices)
- Generate Scene 1 of 3 for Chapter 1
- Output 10 dialogue lines with choices
```

**JSON ì‘ë‹µ ì˜ˆì‹œ**:
```json
[
  {
    "speaker": "Narrator",
    "text": "ì •ì›ì— ë„ì°©í•œ ìˆœê°„, ì´ìƒí•œ ê¸°ìš´ì´ ëŠê»´ì¡Œë‹¤.",
    "character1_name": "ì£¼ì¸ê³µ",
    "character1_expression": "neutral",
    "character1_pose": "normal",
    "character1_position": "Center",
    "bg_name": "EnchantedGarden_Day",
    "bgm_name": "Mysterious_Calm",
    "sfx_name": null,
    "choices": null
  },
  {
    "speaker": "ì—˜ëŸ°",
    "text": "ì—¬ê¸°ê°€... ê·¸ ì „ì„¤ì˜ í™˜ìƒì •ì›ì¸ê°€ìš”?",
    "character1_name": "ì—˜ëŸ°",
    "character1_expression": "surprised",
    "character1_pose": "normal",
    "character1_position": "Right",
    "character2_name": "ì£¼ì¸ê³µ",
    "character2_expression": "neutral",
    "character2_pose": "normal",
    "character2_position": "Left",
    "bg_name": "EnchantedGarden_Day",
    "bgm_name": "Mysterious_Calm",
    "sfx_name": null,
    "choices": [
      {
        "text": "ì •ì›ì„ íƒí—˜í•˜ì.",
        "next_id": 5,
        "skill_impact": [
          { "skill_name": "ìš©ê¸°", "change": 10 }
        ],
        "affection_impact": [
          { "character_name": "ì—˜ëŸ°", "change": 5 }
        ]
      },
      {
        "text": "ì¡°ì‹¬ìŠ¤ëŸ½ê²Œ ê´€ì°°í•œë‹¤.",
        "next_id": 7,
        "skill_impact": [
          { "skill_name": "íŒë‹¨ë ¥", "change": 10 }
        ]
      }
    ]
  }
]
```

**íŒŒì‹± ë° ë³€í™˜**:
```csharp
AIDataConverter.FromAIJson(jsonResponse, chapterId: 1)
â†’ List<DialogueRecord>
```

**ì¶”ì¶œë˜ëŠ” ì—ì…‹ ëª©ë¡**:
- **ë°°ê²½ ì´ë¦„**: `bg_name` í•„ë“œì—ì„œ ì¶”ì¶œ (ì˜ˆ: "EnchantedGarden_Day", "CastleHall_Night")
- **BGM ì´ë¦„**: `bgm_name` í•„ë“œì—ì„œ ì¶”ì¶œ (ì˜ˆ: "Mysterious_Calm", "Battle_Theme")
- **SFX ì´ë¦„**: `sfx_name` í•„ë“œì—ì„œ ì¶”ì¶œ (ì˜ˆ: "DoorOpen", "Footstep")
- **CG ID**: `cg_id` í•„ë“œì—ì„œ ì¶”ì¶œ (ì˜ˆ: "Ch1_CG1")

**ì˜ˆìƒ ì‹œê°„**: ì•½ 10-20ì´ˆ

---

### Cycle 3: ì±•í„°1 ì—ì…‹ ë³‘ë ¬ ìƒì„±

**ë©”ì„œë“œ**: `ParallelAssetGenerator.RunCycle3()`

**ì…ë ¥**: Cycle 2ì—ì„œ ìƒì„±ëœ ì±•í„°1 JSON

**ì—ì…‹ ëª©ë¡ íŒŒì‹±**:
```csharp
ParseChapter1Assets(chapter1JSON)
â†’ AssetList {
    backgrounds: ["EnchantedGarden_Day", "CastleHall_Night"],
    bgmNames: ["Mysterious_Calm", "Battle_Theme"],
    sfxNames: ["DoorOpen", "Footstep", "MagicCast"],
    cgs: [
        { cgId: "Ch1_CG1", description: "...", characters: ["ì£¼ì¸ê³µ", "ì—˜ëŸ°"] }
    ]
}
```

**ë³‘ë ¬ ìƒì„± ì‘ì—…**:

#### 1) ë°°ê²½ ì´ë¯¸ì§€ ìƒì„±

**API**: NanoBanana API

**í”„ë¡¬í”„íŠ¸**:
```
"A high-quality anime-style background for a visual novel.
Scene: {bg_name} (ì˜ˆ: Enchanted Garden at daytime)
Style: Soft colors, detailed environment, no characters.
Lighting: Natural and atmospheric.
Resolution: 1920Ã—1080."
```

**ì €ì¥ ìœ„ì¹˜**: `Assets/Resources/Image/Background/{bg_name}.png`

---

#### 2) CG ì¼ëŸ¬ìŠ¤íŠ¸ ìƒì„± (ë ˆí¼ëŸ°ìŠ¤ ê¸°ë°˜)

**API**: NanoBanana API (Multi-image reference)

**ì…ë ¥**:
- **ë ˆí¼ëŸ°ìŠ¤ ì´ë¯¸ì§€**: ë“±ì¥ ìºë¦­í„°ë“¤ì˜ `facePreview` ì´ë¯¸ì§€
- **ì¥ë©´ ì„¤ëª…**: `cg_scene_description`
- **ì¡°ëª…**: `cg_lighting`
- **ë¶„ìœ„ê¸°**: `cg_mood`
- **ì¹´ë©”ë¼ ê°ë„**: `cg_camera_angle`

**í”„ë¡¬í”„íŠ¸**:
```
"A high-quality full-screen illustration in detailed watercolor / painterly style.
Use the provided reference faces to preserve character identity.
Scene: {cg_scene_description}
Lighting: {cg_lighting}
Mood: {cg_mood}
Camera angle: {cg_camera_angle}
Resolution: 1920Ã—1080."

Reference Images:
- ì£¼ì¸ê³µ face_preview.png
- ì—˜ëŸ° face_preview.png
```

**ì €ì¥ ìœ„ì¹˜**: `Assets/Resources/Image/CG/{cg_id}.png`

---

#### 3) BGM ìƒì„±

**API**: ElevenLabs Sound Generation API

**í”„ë¡¬í”„íŠ¸**:
```json
{
  "text": "mysterious calm ambient music with soft piano and strings",
  "duration_seconds": 60,
  "prompt_influence": 0.3
}
```

**ì €ì¥ ìœ„ì¹˜**: `Assets/Resources/Sound/BGM/{bgm_name}.mp3`

---

#### 4) SFX ìƒì„±

**API**: ElevenLabs Sound Generation API

**í”„ë¡¬í”„íŠ¸**:
```json
{
  "text": "door opening sound, wooden door creaking",
  "duration_seconds": 3,
  "prompt_influence": 0.5
}
```

**ì €ì¥ ìœ„ì¹˜**: `Assets/Resources/Sound/SFX/{sfx_name}.mp3`

---

**ì§„í–‰ë¥  í‘œì‹œ**:
```
Cycle 1 & 2: 0% â†’ 50%
Cycle 3:
  - ë°°ê²½ 1/3 ì™„ë£Œ â†’ 60%
  - ë°°ê²½ 2/3 ì™„ë£Œ â†’ 70%
  - CG 1/2 ì™„ë£Œ â†’ 80%
  - BGM 1/5 ì™„ë£Œ â†’ 85%
  - SFX 1/10 ì™„ë£Œ â†’ 90%
  - ëª¨ë“  ì—ì…‹ ì™„ë£Œ â†’ 100%
```

**ì˜ˆìƒ ì‹œê°„**:
- ë°°ê²½ 2-3ê°œ Ã— 10ì´ˆ = 30ì´ˆ
- CG 1-2ê°œ Ã— 15ì´ˆ = 30ì´ˆ
- BGM 3-5ê°œ Ã— 10ì´ˆ = 40ì´ˆ
- SFX 5-10ê°œ Ã— 5ì´ˆ = 40ì´ˆ
- **ì´ ì•½ 2-3ë¶„**

---

### í…ŒìŠ¤íŠ¸ ëª¨ë“œ (F5 AutoFill)

**ì¡°ê±´**: `SetupWizardAutoFill` ì»´í¬ë„ŒíŠ¸ê°€ í™œì„±í™”ë˜ì–´ ìˆì„ ë•Œ

**ìŠ¤í‚µë˜ëŠ” ì‘ì—…**:
- âœ… Cycle 1 & 2ëŠ” ì •ìƒ ì‹¤í–‰ (ìŠ¤íƒ ë”© + ì±•í„°1 JSON ìƒì„±)
- âŒ **Cycle 3 ìŠ¤í‚µ** (ë°°ê²½/CG/BGM/SFX ìƒì„± ì•ˆ í•¨)

**ëª©ì **: ë¹ ë¥¸ í”„ë¡œí† íƒ€ì… í…ŒìŠ¤íŠ¸ (ì•½ 3ë¶„ â†’ 30ì´ˆë¡œ ë‹¨ì¶•)

---

## ğŸ® Phase 3: ëŸ°íƒ€ì„ ì±•í„° ìƒì„±

### GameScene ë¡œë“œ í”Œë¡œìš°

```
1. GameScene.Start()
   â†“
2. SaveDataManagerì—ì„œ í˜„ì¬ SaveFile ë¡œë“œ
   â†“
3. GameStateSnapshot ì´ˆê¸°í™”
   - coreValueScores: ëª¨ë‘ 0
   - skillScores: ëª¨ë‘ 0
   - characterAffections: ì´ˆê¸° í˜¸ê°ë„
   - chapterSummaries: ë¹„ì–´ìˆìŒ
   â†“
4. StartChapter(chapterId: 1)
   â†“
5. ChapterGenerationManager.GenerateOrLoadChapter()
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  ìºì‹œ í™•ì¸                    â”‚
   â”‚  cacheKey = {ProjectGuid}_Ch1â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â†“                    â†“
ìºì‹œ ìˆìŒ               ìºì‹œ ì—†ìŒ
   â†“                    â†“
LoadCached()        Generate()
                        â†“
                    Gemini API
                    (3 scenes Ã— 10 lines)
                        â†“
                    AIDataConverter
                        â†“
                    CacheToDisk()
   â†“                    â†“
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â†“
6. DialogueUI.ShowCurrentLine()
   - ì²« ëŒ€ì‚¬ í‘œì‹œ
   - ìºë¦­í„° ìŠ¤íƒ ë”© ë¡œë“œ
   - ë°°ê²½ ë¡œë“œ
   - BGM ì¬ìƒ
```

---

### ì±•í„° ìƒì„± ìƒì„¸ í”Œë¡œìš°

**íŒŒì¼**: `ChapterGenerationManager.cs`

#### 1. ìºì‹œ í‚¤ ìƒì„±

```csharp
GenerateCacheKey(chapterId, state)
â†’ "{ProjectGuid}_Ch{ChapterId}"
â†’ ì˜ˆ: "5ec38237_Ch1"
```

**Chapter-Level Convergence**:
- ëª¨ë“  í”Œë ˆì´ì–´ê°€ ê°™ì€ ì±•í„° ë²ˆí˜¸ë©´ **ê°™ì€ ìºì‹œ ì‚¬ìš©**
- Core Value ì ìˆ˜ ë¬´ê´€ (ìŠ¤í† ë¦¬ëŠ” ë™ì¼, ì ìˆ˜ë§Œ ë‹¤ë¦„)

---

#### 2. ì”¬ ë‹¨ìœ„ ë¶„í•  ìƒì„± (3 Scenes)

**ì™œ ë¶„í• ?**
- Gemini API ì¶œë ¥ ì œí•œ: í•œ ë²ˆì— 10-15ì¤„ë§Œ ì•ˆì •ì ìœ¼ë¡œ ìƒì„±
- ê¸´ ì±•í„° ìƒì„± ì‹œ JSON ë¶ˆì™„ì „ ì‘ë‹µ ë°©ì§€

**Scene 1 ìƒì„±**:
```csharp
BuildScenePrompt(chapterId: 1, sceneNumber: 1, totalScenes: 3, state, previousScenes: "")
â†’ Gemini API í˜¸ì¶œ
â†’ JSON Response (10 lines)
â†’ AIDataConverter.FromAIJson(jsonResponse, chapterId: 1)
â†’ DialogueRecord[] (ID: 1000-1009)
```

**Scene 2 ìƒì„±**:
```csharp
// previousScenes ì»¨í…ìŠ¤íŠ¸ ì „ë‹¬
previousScenesContext = "=== Scene 1 ===\nì—˜ëŸ°: ì—¬ê¸°ê°€ ì •ì›ì¸ê°€ìš”?\nì£¼ì¸ê³µ: ê·¸ëŸ° ê²ƒ ê°™ì•„.\n..."

BuildScenePrompt(chapterId: 1, sceneNumber: 2, totalScenes: 3, state, previousScenes: previousScenesContext)
â†’ Gemini API í˜¸ì¶œ
â†’ DialogueRecord[] (ID: 1010-1019)
```

**Scene 3 ìƒì„±**:
```csharp
previousScenesContext += "\n=== Scene 2 ===\n..."
BuildScenePrompt(chapterId: 1, sceneNumber: 3, totalScenes: 3, state, previousScenes: previousScenesContext)
â†’ DialogueRecord[] (ID: 1020-1029)
```

**ì”¬ ì—°ê²°**:
```csharp
// Scene 1 ë§ˆì§€ë§‰ ë¼ì¸ (ID: 1009)
if (!record.Has("NextIndex1")) {
    record.Fields["NextIndex1"] = "1010";  // Scene 2 ì²« ë¼ì¸
    record.Fields["Auto"] = "TRUE";
}

// Scene 2 ë§ˆì§€ë§‰ ë¼ì¸ (ID: 1019)
if (!record.Has("NextIndex1")) {
    record.Fields["NextIndex1"] = "1020";  // Scene 3 ì²« ë¼ì¸
    record.Fields["Auto"] = "TRUE";
}
```

---

#### 3. AI í”„ë¡¬í”„íŠ¸ ì£¼ìš” ì§€ì‹œì‚¬í•­

**Chapter-Level Convergence êµ¬ì¡°**:
```
# CRITICAL - Chapter-Level Convergence Structure
This chapter has a FIXED NARRATIVE ARC that all players experience:

1. Choices affect RELATIONSHIPS and VALUES, NOT the main plot
2. Branching â†’ Convergence Pattern
   - After each choice, create 2-3 different dialogue responses
   - Then CONVERGE back to the main narrative within 1-2 lines
3. Next ID Management for Branching
   - Choice A â†’ next_id: 1005
   - Choice B â†’ next_id: 1007
   - Line 1006 (Choice A result) â†’ next_id: 1009 (CONVERGENCE)
   - Line 1008 (Choice B result) â†’ next_id: 1009 (CONVERGENCE)
```

**Skill Impact ì§€ì‹œ**:
```
CRITICAL - Choice Impact Rules:
- NEVER use "value_impact" field - it is deprecated!
- ONLY use "skill_impact" to affect derived skills
- Core values are calculated automatically as the sum of their derived skills
- Available derived skills for this project: {coreValuesInfo}
- Example skill_impact format:
  "skill_impact": [
    { "skill_name": "[choose from the derived skills listed above]", "change": 5 to 15 }
  ]
- Each choice should affect 1-3 relevant derived skills
- Use skill names EXACTLY as listed in the Core Values section above
```

---

#### 4. ìºì‹œ ì €ì¥

**íŒŒì¼ ê²½ë¡œ**:
```
{Application.persistentDataPath}/Chapters/{ProjectGuid}/{ProjectGuid}_Ch1.json
```

**ì˜ˆì‹œ**:
```
/Users/yuli/Library/Application Support/YuliSpiel/IYAGI_AI/Chapters/5ec38237.../5ec38237_Ch1.json
```

**ë‚´ìš©**:
```json
{
  "chapterId": 1,
  "records": [ /* DialogueRecord[] */ ],
  "stateSnapshot": { /* GameStateSnapshot */ },
  "timestamp": 1673520000
}
```

---

### ì±•í„° ì™„ë£Œ ë° ë‹¤ìŒ ì±•í„° ì „í™˜

**íŒŒì¼**: `GameController.cs`

#### 1. ì±•í„° ì™„ë£Œ ê°ì§€

```csharp
NextLine()
{
    // ë§ˆì§€ë§‰ ë¼ì¸ ì²´í¬
    if (currentLineIndex >= currentChapterRecords.Count - 1) {
        OnChapterEnd();
    }
}
```

---

#### 2. ì±•í„° ìš”ì•½ ìƒì„±

```csharp
OnChapterEnd()
â†’ StartCoroutine(GenerateChapterSummaryAndContinue())
    â†“
ShowLoadingPanel(true, "ì±•í„° ìš”ì•½ ìƒì„± ì¤‘...")
    â†“
ChapterGenerationManager.GenerateChapterSummary(chapterId, records)
    â†“
Gemini API í˜¸ì¶œ:
Prompt: "Summarize the following chapter in 2-3 sentences that capture:
         1. The main events that happened
         2. Key character interactions or developments
         3. Any important plot points or revelations"
    â†“
AI Response: "ì£¼ì¸ê³µì€ í™˜ìƒì •ì›ì— ë„ì°©í•˜ì—¬ ìˆ˜í˜¸ì ì—˜ëŸ°ì„ ë§Œë‚¬ë‹¤.
             ì •ì›ì˜ ë¹„ë°€ì„ í’€ê¸° ìœ„í•´ íƒí—˜ì„ ì‹œì‘í–ˆìœ¼ë©°,
             ì²« ë²ˆì§¸ ì‹œë ¨ì„ í†µê³¼í–ˆë‹¤."
    â†“
currentState.chapterSummaries[1] = "ì£¼ì¸ê³µì€ í™˜ìƒì •ì›ì—..."
    â†“
ShowLoadingPanel(false)
    â†“
currentChapterId++  // 2
    â†“
StartChapter(2)
```

---

#### 3. ë‹¤ìŒ ì±•í„° ì‹œì‘ (ìš”ì•½ í¬í•¨)

```csharp
StartChapter(chapterId: 2)
â†’ ShowLoadingPanel(true, "Chapter 2 ìƒì„± ì¤‘...")
â†’ ChapterGenerationManager.GenerateOrLoadChapter(2, currentState)
    â†“
BuildScenePrompt(chapterId: 2, ...)
    â†“
Prompt includes:
# Current State
Current Chapter: 2
Core Values: ìš©ê¸°=15, ì§€í˜œ=10, ìš°ì •=5
Skills: ê²€ìˆ =10, íŒë‹¨ë ¥=5, ...
Character Affections: ì—˜ëŸ°=15

Previous Chapters:
  Chapter 1: ì£¼ì¸ê³µì€ í™˜ìƒì •ì›ì— ë„ì°©í•˜ì—¬ ìˆ˜í˜¸ì ì—˜ëŸ°ì„ ë§Œë‚¬ë‹¤.
             ì •ì›ì˜ ë¹„ë°€ì„ í’€ê¸° ìœ„í•´ íƒí—˜ì„ ì‹œì‘í–ˆìœ¼ë©°,
             ì²« ë²ˆì§¸ ì‹œë ¨ì„ í†µê³¼í–ˆë‹¤.
    â†“
Gemini APIê°€ Chapter 1 ë§¥ë½ì„ ì´í•´í•˜ê³  ìì—°ìŠ¤ëŸ½ê²Œ ì—°ê²°ë˜ëŠ” Chapter 2 ìƒì„±
    â†“
DialogueUI.ShowCurrentLine()
```

---

### ì„ íƒì§€ ì²˜ë¦¬ ë° ìŠ¤í‚¬ ë³€í™”

**íŒŒì¼**: `GameController.cs`

#### OnChoiceSelected(choiceIndex)

```csharp
// 1. ì„ íƒì§€ í…ìŠ¤íŠ¸ ì €ì¥
string choiceText = currentLine.GetString($"Choice{choiceIndex + 1}");
currentState.previousChoices.Add(choiceText);

// 2. Skill Impact ì²˜ë¦¬
foreach (var value in projectData.coreValues) {
    foreach (var skill in value.derivedSkills) {
        string skillImpactKey = $"Choice{choiceIndex + 1}_SkillImpact_{skill}";
        if (currentLine.Has(skillImpactKey) && currentLine.TryGetInt(skillImpactKey, out int skillChange)) {
            currentState.skillScores[skill] += skillChange;
            Debug.Log($"[Skill] '{skill}' changed by {skillChange} (now: {currentState.skillScores[skill]})");
        }
    }
}

// 3. Core Values ì¬ê³„ì‚° (íŒŒìƒ ìŠ¤í‚¬ í•©ì‚°)
RecalculateCoreValues();

// 4. Affection Impact ì²˜ë¦¬
foreach (var npc in projectData.npcs) {
    string affectKey = $"Choice{choiceIndex + 1}_AffectionImpact_{npc.characterName}";
    if (currentLine.Has(affectKey) && currentLine.TryGetInt(affectKey, out int change)) {
        currentState.characterAffections[npc.characterName] += change;
        Debug.Log($"{npc.characterName} affection changed by {change}");
    }
}

// 5. Next IDë¡œ ì í”„
string nextIdKey = $"Next{choiceIndex + 1}";
if (currentLine.TryGetInt(nextIdKey, out int nextId)) {
    for (int i = 0; i < currentChapterRecords.Count; i++) {
        if (currentChapterRecords[i].TryGetInt("ID", out int lineId) && lineId == nextId) {
            currentLineIndex = i;
            ShowCurrentLine();
            return;
        }
    }
}
```

---

### ì—”ë”© ì”¬ ìƒì„±

**íŒŒì¼**: `GameController.cs`

#### ë§ˆì§€ë§‰ ì±•í„° ì™„ë£Œ ì‹œ

```csharp
OnChapterEnd()
â†’ GenerateChapterSummaryAndContinue()
    â†“
if (currentChapterId >= projectData.totalChapters) {
    // ê²Œì„ ì¢…ë£Œ - ì—”ë”© ì”¬ ìƒì„±
    GenerateAndShowEndingScene()
}
```

---

#### ì—”ë”© íƒ€ì… ê²°ì •

```csharp
DetermineEndingType()
{
    // EndingManager ì´ˆê¸°í™”
    endingManager.Initialize(projectData, currentState);

    // ì—”ë”© ê²°ì •
    string endingType = endingManager.DetermineEnding();
    // â†’ "True Ending" or "ìš©ê¸° Ending" or "Normal Ending"

    return endingType;
}
```

---

#### ì—”ë”© ì”¬ ë¡œë“œ (ë¯¸ë¦¬ ì‘ì„±ëœ ì—”ë”©)

```csharp
ShowLoadingPanel(true, "ì—”ë”© ì”¬ ì¤€ë¹„ ì¤‘...")
    â†“
ChapterGenerationManager.GenerateEndingScene(endingType, currentState)
    â†“
EndingSceneDatabaseì—ì„œ í•´ë‹¹ ì—”ë”© ê°€ì ¸ì˜¤ê¸°
    â†“
EndingSceneData.ToDialogueRecords()
    â†“
currentChapterRecords = endingRecords
currentChapterId = 999  // ì—”ë”© ì”¬ ID
ShowCurrentLine()
    â†“
[ì—”ë”© ëŒ€ì‚¬ í‘œì‹œ]
    â†“
ì—”ë”© ì”¬ ë§ˆì§€ë§‰ ë¼ì¸ (next_id: 0)
    â†“
ShowEndingPanel(endingType)
```

---

## ğŸ’¾ ë°ì´í„° ì €ì¥ êµ¬ì¡°

### ScriptableObject ì €ì¥ ìœ„ì¹˜

```
Assets/Resources/VNProjects/
â”œâ”€â”€ {GameTitle}.asset                    # VNProjectData
â”œâ”€â”€ {GameTitle}/
â”‚   â””â”€â”€ Characters/
â”‚       â”œâ”€â”€ {PlayerName}.asset           # CharacterData
â”‚       â”œâ”€â”€ {NPC1_Name}.asset
â”‚       â””â”€â”€ {NPC2_Name}.asset
```

### ë¦¬ì†ŒìŠ¤ ì €ì¥ ìœ„ì¹˜

```
Assets/Resources/
â”œâ”€â”€ Generated/
â”‚   â””â”€â”€ Characters/
â”‚       â”œâ”€â”€ {PlayerName}/
â”‚       â”‚   â”œâ”€â”€ face_preview.png         # ì–¼êµ´ í”„ë¦¬ë·° (CG ë ˆí¼ëŸ°ìŠ¤)
â”‚       â”‚   â”œâ”€â”€ neutral_normal.png       # ìŠ¤íƒ ë”© 5ì¢…
â”‚       â”‚   â”œâ”€â”€ happy_normal.png
â”‚       â”‚   â”œâ”€â”€ sad_normal.png
â”‚       â”‚   â”œâ”€â”€ angry_normal.png
â”‚       â”‚   â”œâ”€â”€ surprised_normal.png
â”‚       â”‚   â””â”€â”€ [ëŸ°íƒ€ì„ ì¶”ê°€ ìƒì„± ê°€ëŠ¥]
â”‚       â””â”€â”€ {NPC_Name}/
â”‚           â””â”€â”€ ...
â”œâ”€â”€ Image/
â”‚   â”œâ”€â”€ Background/
â”‚   â”‚   â”œâ”€â”€ EnchantedGarden_Day.png
â”‚   â”‚   â”œâ”€â”€ CastleHall_Night.png
â”‚   â”‚   â””â”€â”€ ...
â”‚   â””â”€â”€ CG/
â”‚       â”œâ”€â”€ Ch1_CG1.png
â”‚       â”œâ”€â”€ Ch2_CG1.png
â”‚       â””â”€â”€ ...
â””â”€â”€ Sound/
    â”œâ”€â”€ BGM/
    â”‚   â”œâ”€â”€ Mysterious_Calm.mp3
    â”‚   â”œâ”€â”€ Battle_Theme.mp3
    â”‚   â””â”€â”€ ...
    â””â”€â”€ SFX/
        â”œâ”€â”€ DoorOpen.mp3
        â”œâ”€â”€ Footstep.mp3
        â””â”€â”€ ...
```

### ëŸ°íƒ€ì„ ìºì‹œ ì €ì¥ ìœ„ì¹˜

```
{Application.persistentDataPath}/
â”œâ”€â”€ Chapters/
â”‚   â””â”€â”€ {ProjectGuid}/
â”‚       â”œâ”€â”€ {ProjectGuid}_Ch1.json
â”‚       â”œâ”€â”€ {ProjectGuid}_Ch2.json
â”‚       â””â”€â”€ ...
â””â”€â”€ SaveData/
    â”œâ”€â”€ ProjectSlots.json
    â””â”€â”€ {SlotId}/
        â”œâ”€â”€ autosave.json
        â”œâ”€â”€ {SaveId1}.json
        â””â”€â”€ {SaveId2}.json
```

**ì˜ˆì‹œ (macOS)**:
```
/Users/yuli/Library/Application Support/YuliSpiel/IYAGI_AI/
â”œâ”€â”€ Chapters/
â”‚   â””â”€â”€ 5ec38237-42f8-4186-b254-ca3f43545f97/
â”‚       â”œâ”€â”€ 5ec38237-42f8-4186-b254-ca3f43545f97_Ch1.json
â”‚       â””â”€â”€ 5ec38237-42f8-4186-b254-ca3f43545f97_Ch2.json
â””â”€â”€ SaveData/
    â””â”€â”€ ...
```

---

## ğŸ”§ íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### 1. ì±•í„° ìƒì„± ì‹œ JSON íŒŒì‹± ì‹¤íŒ¨

**ì¦ìƒ**:
```
[AIDataConverter] JSON parsing error: Unexpected token }
```

**ì›ì¸**: Gemini APIê°€ ë¶ˆì™„ì „í•œ JSON ë°˜í™˜ (ë§ˆì§€ë§‰ `]` ëˆ„ë½)

**í•´ê²°**:
- `AIDataConverter.AttemptJSONRepair()` ìë™ ë³µêµ¬ ì‹œë„
- ë§ˆì§€ë§‰ ì™„ì„±ëœ ê°ì²´ê¹Œì§€ë§Œ íŒŒì‹±, ë¶ˆì™„ì „í•œ ë¶€ë¶„ ë²„ë¦¼

---

### 2. ì„ íƒì§€ê°€ ì‘ë™í•˜ì§€ ì•ŠìŒ (next_id ì˜¤ë¥˜)

**ì¦ìƒ**: ì„ íƒì§€ í´ë¦­ ì‹œ ë‹¤ìŒ ëŒ€ì‚¬ë¡œ ì´ë™í•˜ì§€ ì•ŠìŒ

**ì›ì¸**: AIê°€ ìƒì„±í•œ `next_id`ê°€ ìƒëŒ€ ì¸ë±ìŠ¤ (7, 8)ì¸ë° ì ˆëŒ€ ID (1007, 1008)ë¡œ ë³€í™˜ ì•ˆ ë¨

**í•´ê²°**: âœ… ì´ë¯¸ ìˆ˜ì •ë¨
```csharp
// AIDataConverter.cs:120-123
int aiNextId = line.choices[c].next_id;
int actualNextId = (aiNextId == 0) ? 0 : (baseId + aiNextId);
record.Fields[$"Next{choiceNum}"] = actualNextId.ToString();
```

---

### 3. ìŠ¤í‚¬ì´ ë³€í™”í•˜ì§€ ì•ŠìŒ

**ì¦ìƒ**: ì„ íƒì§€ ì„ íƒí•´ë„ ìŠ¤í‚¬ ì ìˆ˜ ê·¸ëŒ€ë¡œ

**ì›ì¸**: AIê°€ ìƒì„±í•œ `skill_name`ê³¼ í”„ë¡œì íŠ¸ì˜ `derivedSkills` ì´ë¦„ ë¶ˆì¼ì¹˜

**í•´ê²°**: âœ… ì´ë¯¸ ìˆ˜ì •ë¨
```csharp
// ChapterGenerationManager.cs:248-257
CRITICAL - Choice Impact Rules:
- Available derived skills for this project:{coreValuesInfo}
- Use skill names EXACTLY as listed in the Core Values section above
```

---

### 4. ì±•í„° ê°„ ìŠ¤í† ë¦¬ ì¼ê´€ì„± ë¶€ì¡±

**ì¦ìƒ**: Chapter 2ê°€ Chapter 1ê³¼ ì „í˜€ ë¬´ê´€í•œ ë‚´ìš©

**ì›ì¸**: AIê°€ ì´ì „ ì±•í„° ë‚´ìš©ì„ ëª¨ë¦„

**í•´ê²°**: âœ… ì´ë¯¸ ìˆ˜ì •ë¨
```csharp
// GameStateSnapshot.chapterSummaries ì¶”ê°€
// ChapterGenerationManager.GenerateChapterSummary() ìë™ í˜¸ì¶œ
// AI í”„ë¡¬í”„íŠ¸ì— ì´ì „ ì±•í„° ìš”ì•½ í¬í•¨
```

---

### 5. ì±•í„° ìƒì„± ì¤‘ í´ë¦­ ì‹œ ì—”ë”© íŒì—… ëœ¸

**ì¦ìƒ**: ë¡œë”© ì¤‘ì¸ë° í™”ë©´ í´ë¦­í•˜ë©´ ì—”ë”© íŒ¨ë„ì´ ë‚˜íƒ€ë‚¨

**ì›ì¸**: ì±•í„° ìƒì„± ì¤‘ì—ë„ NextLine(), OnChoiceSelected() í˜¸ì¶œ ê°€ëŠ¥

**í•´ê²°**: âœ… ì´ë¯¸ ìˆ˜ì •ë¨
```csharp
// GameController.cs
public bool isGeneratingChapter = false;

NextLine() {
    if (isGeneratingChapter) return;
    ...
}

OnChoiceSelected() {
    if (isGeneratingChapter) return;
    ...
}

StartChapter() {
    isGeneratingChapter = true;
    ShowLoadingPanel(true, "Chapter X ìƒì„± ì¤‘...");
    ...
    isGeneratingChapter = false;
    ShowLoadingPanel(false);
}
```

---

### 6. ìºì‹œ ì‚­ì œ ë°©ë²•

**ìœ„ì¹˜**:
```
{Application.persistentDataPath}/Chapters/{ProjectGuid}/
```

**macOS**:
```bash
rm -rf "/Users/yuli/Library/Application Support/YuliSpiel/IYAGI_AI/Chapters/{ProjectGuid}/"
```

**Windows**:
```
%USERPROFILE%\AppData\LocalLow\YuliSpiel\IYAGI_AI\Chapters\{ProjectGuid}\
```

---

## ğŸ“Š ì „ì²´ íƒ€ì„ë¼ì¸

| ë‹¨ê³„ | ì‘ì—… | ì˜ˆìƒ ì‹œê°„ | API í˜¸ì¶œ |
|------|------|----------|---------|
| **Setup Wizard** | Step 1-5 ì…ë ¥ + ì–¼êµ´ í”„ë¦¬ë·° | 5-10ë¶„ | Player + NPC ê° 1íšŒ |
| **Cycle 1** | ìºë¦­í„° ìŠ¤íƒ ë”© ìƒì„± (5ì¢… Ã— Nëª…) | 2-3ë¶„ | 5 Ã— Nëª… |
| **Cycle 2** | ì±•í„°1 JSON ìƒì„± (3 scenes) | 30ì´ˆ | Gemini Ã— 3 |
| **Cycle 3** | ì±•í„°1 ì—ì…‹ ìƒì„± (ë°°ê²½/CG/BGM/SFX) | 2-3ë¶„ | 10-20íšŒ |
| **GameScene ë¡œë“œ** | ìºì‹œ ë¡œë“œ ë˜ëŠ” ì‹ ê·œ ìƒì„± | ì¦‰ì‹œ / 30ì´ˆ | 0 / 3íšŒ |
| **ì±•í„° ì™„ë£Œ** | ìš”ì•½ ìƒì„± | 10ì´ˆ | Gemini Ã— 1 |
| **ë‹¤ìŒ ì±•í„°** | ìºì‹œ ë¡œë“œ ë˜ëŠ” ì‹ ê·œ ìƒì„± | ì¦‰ì‹œ / 30ì´ˆ | 0 / 3íšŒ |

**ì´ ì†Œìš” ì‹œê°„**: ì•½ 10-15ë¶„ (í”„ë¡œì íŠ¸ ìƒì„± + ì²« í”Œë ˆì´)

---

## ğŸ¯ ìµœì¢… ê²°ê³¼ë¬¼

### ìƒì„±ë˜ëŠ” íŒŒì¼ ê°œìˆ˜ (ì˜ˆì‹œ: Player + NPC 2ëª…, 3ì±•í„° ê²Œì„)

**ScriptableObjects**: 4ê°œ
- VNProjectData Ã— 1
- CharacterData Ã— 3 (Player + NPC 2ëª…)

**ì´ë¯¸ì§€**:
- ì–¼êµ´ í”„ë¦¬ë·°: 3ê°œ
- ìŠ¤íƒ ë”© ìŠ¤í”„ë¼ì´íŠ¸: 15ê°œ (5ì¢… Ã— 3ëª…)
- ë°°ê²½: 6-9ê°œ (ì±•í„°ë‹¹ 2-3ê°œ)
- CG: 3-6ê°œ (ì±•í„°ë‹¹ 1-2ê°œ)
- **ì´ ì•½ 30-35ê°œ**

**ì˜¤ë””ì˜¤**:
- BGM: 9-15ê°œ (ì±•í„°ë‹¹ 3-5ê°œ)
- SFX: 15-30ê°œ (ì±•í„°ë‹¹ 5-10ê°œ)
- **ì´ ì•½ 25-45ê°œ**

**ìºì‹œ JSON**: 3ê°œ (ì±•í„°ë‹¹ 1ê°œ)

**SaveFile JSON**: 1-10ê°œ (í”Œë ˆì´ì–´ë‹¹)

---

## ğŸ“ ìš”ì•½

1. **Setup Wizard (5-10ë¶„)**: ì‚¬ìš©ìê°€ ê²Œì„ ê°œìš”/ê°€ì¹˜/ìºë¦­í„° ì…ë ¥, AIê°€ ìë™ ì œì•ˆ
2. **Cycle 1 & 2 (ë³‘ë ¬, 3ë¶„)**: ëª¨ë“  ìºë¦­í„° ìŠ¤íƒ ë”© ìƒì„± + ì±•í„°1 JSON ìƒì„±
3. **Cycle 3 (2-3ë¶„)**: ì±•í„°1 ì—ì…‹ (ë°°ê²½/CG/BGM/SFX) ë³‘ë ¬ ìƒì„±
4. **GameScene**: ìºì‹œëœ ì±•í„° ë¡œë“œ ë˜ëŠ” ìƒˆë¡œ ìƒì„±, ì„ íƒì§€ì— ë”°ë¼ ìŠ¤í‚¬/í˜¸ê°ë„ ë³€í™”
5. **ì±•í„° ì™„ë£Œ**: AIê°€ ìš”ì•½ ìƒì„± â†’ ë‹¤ìŒ ì±•í„° ë§¥ë½ ì œê³µ
6. **ì—”ë”©**: ìµœì¢… Core Value ì ìˆ˜ë¡œ ì—”ë”© ê²°ì •, ë¯¸ë¦¬ ì‘ì„±ëœ ì—”ë”© ì”¬ í‘œì‹œ

**í•µì‹¬ íŠ¹ì§•**:
- âœ… Chapter-Level Convergence: ëª¨ë“  í”Œë ˆì´ì–´ê°€ ê°™ì€ ìŠ¤í† ë¦¬, ë‹¤ë¥¸ ìŠ¤í‚¬/í˜¸ê°ë„
- âœ… ë³‘ë ¬ ì—ì…‹ ìƒì„±: Fan-Out Barrier íŒ¨í„´ìœ¼ë¡œ ë¹ ë¥¸ ìƒì„±
- âœ… ì±•í„° ìºì‹±: í•œ ë²ˆ ìƒì„±í•œ ì±•í„°ëŠ” ì¬ì‚¬ìš© (ê°™ì€ ì±•í„° ë²ˆí˜¸ë©´ ë™ì¼)
- âœ… ì±•í„° ìš”ì•½: AIê°€ ìë™ìœ¼ë¡œ ë§¥ë½ ìƒì„±, ì¼ê´€ëœ ìŠ¤í† ë¦¬ ì „ê°œ
- âœ… UI ì°¨ë‹¨: ì±•í„° ìƒì„± ì¤‘ í´ë¦­ ë°©ì§€, ë¡œë”© íŒì—… í‘œì‹œ

---

**Last Updated**: 2025-01-11
**Document Version**: 1.0
